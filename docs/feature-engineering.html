<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Capítulo 4 Feature Engineering | Predicción de Morosidad</title>
  <meta name="description" content="En este reporte se presenta un estudio de caso en el que se aplica la Ciencia de Datos" />
  <meta name="generator" content="bookdown 0.14 and GitBook 2.6.7" />

  <meta property="og:title" content="Capítulo 4 Feature Engineering | Predicción de Morosidad" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="En este reporte se presenta un estudio de caso en el que se aplica la Ciencia de Datos" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Capítulo 4 Feature Engineering | Predicción de Morosidad" />
  
  <meta name="twitter:description" content="En este reporte se presenta un estudio de caso en el que se aplica la Ciencia de Datos" />
  

<meta name="author" content="Michelle Audirac" />


<meta name="date" content="2020-01-13" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="proyecto.html"/>

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">A Minimal Book Example</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introducción</a></li>
<li class="chapter" data-level="2" data-path="contexto.html"><a href="contexto.html"><i class="fa fa-check"></i><b>2</b> Contexto</a><ul>
<li class="chapter" data-level="2.1" data-path="contexto.html"><a href="contexto.html#la-organización"><i class="fa fa-check"></i><b>2.1</b> La organización</a></li>
<li class="chapter" data-level="2.2" data-path="contexto.html"><a href="contexto.html#problema-a-resolver"><i class="fa fa-check"></i><b>2.2</b> Problema a Resolver</a></li>
<li class="chapter" data-level="2.3" data-path="contexto.html"><a href="contexto.html#solución-propuesta"><i class="fa fa-check"></i><b>2.3</b> Solución Propuesta</a></li>
<li class="chapter" data-level="2.4" data-path="contexto.html"><a href="contexto.html#mecanismo-de-validación"><i class="fa fa-check"></i><b>2.4</b> Mecanismo de Validación</a></li>
<li class="chapter" data-level="2.5" data-path="contexto.html"><a href="contexto.html#plan-de-trabajo"><i class="fa fa-check"></i><b>2.5</b> Plan de Trabajo</a></li>
<li class="chapter" data-level="2.6" data-path="contexto.html"><a href="contexto.html#contacto"><i class="fa fa-check"></i><b>2.6</b> Contacto</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="proyecto.html"><a href="proyecto.html"><i class="fa fa-check"></i><b>3</b> Proyecto</a><ul>
<li class="chapter" data-level="3.1" data-path="proyecto.html"><a href="proyecto.html#historias-de-crédito"><i class="fa fa-check"></i><b>3.1</b> Historias de Crédito</a></li>
<li class="chapter" data-level="3.2" data-path="proyecto.html"><a href="proyecto.html#limpieza-de-datos"><i class="fa fa-check"></i><b>3.2</b> Limpieza de datos</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="feature-engineering.html"><a href="feature-engineering.html"><i class="fa fa-check"></i><b>4</b> Feature Engineering</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Predicción de Morosidad</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="feature-engineering" class="section level1">
<h1><span class="header-section-number">Capítulo 4</span> Feature Engineering</h1>
<p>Hasta este momento, se conoce el comportamiento o características de cada crédito en una fecha de corte específico. En el ejemplo en la figura &lt;ref&gt; sabemos que el cliente <span class="math inline">\(X\)</span> pagó el 75% puntual y el 25% impuntual en el corte 1, pero esa información no nos aporta información del comportamiento de pago del cliente <span class="math inline">\(X\)</span> en el pasado: ¿esta es la primera vez que un porcentaje de su pago es impuntual?, o ¿suele hacer pagos impuntuales frecuentemente?</p>
<p>Para absorber información del comportamiento anterior de los clientes, es posible usar promedios históricos. Un inconveniente al usar el promedio aritmético es que el pasado lejano pesa igual que la historia reciente. Para evitar este problema, podemos usar una función de decaimiento. Es decir hacer un promedio ponderado que le asigne más peso a la historia reciente.</p>
<p>Existen muchos métodos para obtener series de pesos que tengan <strong>decaimiento</strong> y que sumen uno. Algunos métodos obtienen pesos que
decaen demasiado rápido, como el decaimiento exponencial. El <strong>half-life</strong> es un concepto que ayuda a controlar que tan rápido deben decaer el tamaño de los pesos.</p>
<p>Un <strong>half-life se alcanza cuando se acumula la mitad de la suma de los pesos</strong>. En nuestro contexto el decaimiento ocurre de lo más reciente a
lo más lejano. Por ejemplo, un half-life de 3 meses en el contexto de
series con observaciones diarias implica que:</p>
<ul>
<li>los pesos diarios asignados en los tres meses más recientes acumulan
aproximadamente 0.5, y</li>
<li>los pesos para el resto de la serie acumulan aproximadamente 0.5.</li>
</ul>
<p>De esta manera, series de pesos con un half-life de tres meses decaen
más rápido que series de pesos con un half-life de un año.</p>
<p>En el &lt;Anexo&gt; se incluye el detalle teórico del decaimiento
geométrico.</p>
<p>Utilizamos decaimiento con half-life en las series de tiempo del saldo y el porcentaje puntual, impuntual y de rescate de los clientes. La figura &lt;ref&gt; muestra una serie tiempo de saldo suavizado con un half-life de tres meses. Como se observa, el decaimiento no solo incorpora la información del pasado en cada momento, también elimina el ruido en la serie.</p>
<!-- ```{r} -->
<!-- ejemplos <- creditos %>% -->
<!--   filter(indice_ultimo_saldo >= 50) %>% -->
<!--   group_by(pkcolocadora) %>% -->
<!--   summarise(min_saldo = min(saldo_prom_decay), -->
<!--             max_saldo = max(saldo_prom_decay), -->
<!--             diff_saldo = max_saldo - min_saldo) %>% -->
<!--   ungroup() %>% -->
<!--   filter(diff_saldo >= 50000) %>% -->
<!--   pull(pkcolocadora) -->
<!-- for(colocadora_ej in ejemplos[5000:5020]){ -->
<!--   p <- creditos %>% -->
<!--     filter(pkcolocadora == colocadora_ej) %>% -->
<!--     select(fechaCorte, -->
<!--          saldoActual,  -->
<!--          saldo_prom_decay) %>% -->
<!--     rename(date = fechaCorte) %>% -->
<!--    gather(key, value,-date) %>% -->
<!--    ggplot(aes(x = date, -->
<!--              y = value, -->
<!--              colour = key)) + -->
<!--     geom_line() + -->
<!--     labs(title = colocadora_ej) -->
<!--   print(p) -->
<!-- } -->
<!-- ``` -->
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" data-line-number="1">colocadora_ej =<span class="st"> </span><span class="dv">15691</span></a>
<a class="sourceLine" id="cb1-2" data-line-number="2"></a>
<a class="sourceLine" id="cb1-3" data-line-number="3">creditos <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-4" data-line-number="4"><span class="st">  </span><span class="kw">filter</span>(pkcolocadora <span class="op">==</span><span class="st"> </span>colocadora_ej) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb1-5" data-line-number="5"><span class="st">  </span><span class="kw">select</span>(fechaCorte,</a>
<a class="sourceLine" id="cb1-6" data-line-number="6">         saldoActual, </a>
<a class="sourceLine" id="cb1-7" data-line-number="7">         saldo_prom_decay) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-8" data-line-number="8"><span class="st">  </span><span class="kw">rename</span>(<span class="dt">date =</span> fechaCorte) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-9" data-line-number="9"><span class="st">  </span><span class="kw">gather</span>(key, value,<span class="op">-</span>date) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-10" data-line-number="10"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> date,</a>
<a class="sourceLine" id="cb1-11" data-line-number="11">             <span class="dt">y =</span> value,</a>
<a class="sourceLine" id="cb1-12" data-line-number="12">             <span class="dt">colour =</span> key)) <span class="op">+</span><span class="st"> </span></a>
<a class="sourceLine" id="cb1-13" data-line-number="13"><span class="st">  </span><span class="kw">geom_line</span>()</a></code></pre></div>
<p><img src="book_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<p>Aunque se realizaron varias tareas de exploración y limpieza, las series de tiempo de pagos y saldos de los clientes en algunas ocasiones muestran “picos”. Estos picos o registros atípicos los suavizamos con el decaimiento.</p>
<p>Se construyeron seried de tiempo adicionales para capturar la magnitud de los cambios y la volatilidad en los saldos y pagos de los clientes. En el anexo &lt;ref&gt; se describe la construcción de estas variables.</p>
<p>La figura &lt;</p>
<!-- ```{r} -->
<!-- ejemplos <- creditos %>% -->
<!--   filter(indice_ultimo_saldo >= 50) %>% -->
<!--   group_by(pkcolocadora) %>% -->
<!--   summarise(min_saldo = min(saldo_prom_decay), -->
<!--             max_saldo = max(saldo_prom_decay), -->
<!--             diff_saldo = max_saldo - min_saldo) %>% -->
<!--   ungroup() %>% -->
<!--   filter(diff_saldo >= 50000) %>% -->
<!--   pull(pkcolocadora) -->
<!-- for(colocadora_ej in ejemplos[5000:5020]){ -->
<!--   p <- creditos %>% -->
<!--     filter(pkcolocadora == colocadora_ej) %>% -->
<!--     select(fechaCorte, -->
<!--          saldoActual,  -->
<!--          saldo_prom_decay) %>% -->
<!--     rename(date = fechaCorte) %>% -->
<!--    gather(key, value,-date) %>% -->
<!--    ggplot(aes(x = date, -->
<!--              y = value, -->
<!--              colour = key)) + -->
<!--     geom_line() + -->
<!--     labs(title = colocadora_ej) -->
<!--   print(p) -->
<!-- } -->

</div>
            </section>

          </div>
        </div>
      </div>
<a href="proyecto.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"download": ["book.pdf", "book.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
